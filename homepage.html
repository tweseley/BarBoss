<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <title>Homepage</title>

    <!-- Bootstrap -->
    <link href="node_modules/bootstrap/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="homepage.css">

      <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
      <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
      <script src="drinks.js"></script>

  </head>

  <body>



    <div class="container">
    	<div class="row">
        <div class="col-xs-6 col-sm-4 col-lg-3">

          <div class="dropdown" style = "margin-left: 40%; margin-top: 47%;" >
            <button class="btn btn-primary dropdown-toggle" style = "background-color: forestgreen; font-family: georgia" type="button" data-toggle="dropdown">Show Categories
            <span class="caret"></span></button>
            <ul class="dropdown-menu" id="categories"></ul>
          </div>



    		</div>
        <div class="col-xs-12 col-sm-8 col-lg-6">
          <div>
            <h1 style = "text-align: center; font-size: 60px; font-family: cursive ">Bar Boss</h1>
          </div>
          <div id="custom-search-input" style = "margin-top: 5%; margin-bottom: 5%">
              <div class="input-group col-md-12" id="search">
                  <input type="text" class="form-control input-lg" list="dropdown" placeholder="Search tags or a drink..." id="results" onkeydown="if (event.keyCode == 13)
                        document.getElementById('searchButton').click()"/>
                  <datalist id="dropdown"></datalist>
                  <span class="input-group-btn">
                    <a id="href">
                      <button class="btn btn-info btn-lg" id="searchButton" type="button" disabled>
                          <i class="glyphicon glyphicon-search"></i>
                      </button>
                    </a>
                  </span>
              </div>
          </div>
        </div>

        <div style = "float: right">
          <label id="userName" style = "font-family: georgia; font-weight: 100;"></label>
          <a class="btn btn-primary" href="#" onclick="logout()" style = "margin-left: 20px; font-family: Georgia">Log Out</a>
    		</div>

    	</div>
    </div>

    <br>

    <div class="container" id="drinksContainer">
    	<div class="flex-row row" id="drinkRow">
    	</div>
    </div>


    <script language="javascript">
        function authenticate() {
            if (sessionStorage.getItem('loggedIn') == null || sessionStorage.getItem('loggedIn') == false) {
                window.location.href = "signin.html";
            }
        }

        function logout() {
            // sessionStorage.clear();
            window.location.href = "signin.html";
        }

        function populateDropdown() {
          var drop = $('#dropdown');
          for (var i=0; i<tagsList.length; i++){
            var tag = tagsList[i];
            var option = $('<option>', {value: tag});
            drop.append(option);
          }
        }

        function getRelativeHref(href) {
          var currentLocation = window.location.href;
          var prefixArray = currentLocation.split('/');
          var prefixArray = prefixArray.slice(0, prefixArray.length - 1);
          return prefixArray.join('/') + href;
        }

        function isValidSearch(search){
          var searchList = search.toLowerCase().split(" ");
          var andList = search.toLowerCase().split(" and ");
          var orList = search.toLowerCase().split(" or ");
          var andOr = andList.concat(orList);
          for (var i=0; i<andOr.length; i++) {
            if ($.inArray(andOr[i], searchList) == -1) {
              searchList.push(andOr[i]);
            }
          }
          for (var i=0; i<searchList.length; i++) {
            var word = searchList[i];
            if ($.inArray(word, tagsList) > -1){
              return true;
            }
          }
          return false;
        }

        $(document).ready(function()
        {
          authenticate();
          $("#userName").text("Welcome, " + sessionStorage.getItem('userName'));
          populateDrinks();
          linkCategories();
          populateDropdown();

          $('#results').on("keyup change paste click", function() {
            var href = $('#href');
            var searchButton = $('#searchButton');
            var searchParams = $(this).val();
            if (isValidSearch(searchParams)) {
              searchButton.removeAttr('disabled');
              var searchHref = $('<a>', {href: getRelativeHref("/searchresults.html?results="+searchParams)});
              href.attr('href', searchHref.attr('href'));
            } else {
              searchButton.attr("disabled", "disabled");
            }
          });
        });

        function linkCategories() {
          var categories = ["Cobbler", "Collins", "Fizz", "Highball", "Punch", "Smash", "Sour"];
          var categoryNames = ["Cobbler", "Collins", "Fizz", "Highball", "Punch", "Smash", "Sour"];
          var menu = $('#categories');
          for (var i=0; i<categories.length; i++) {
            var category = categories[i];
            var li = $('<li>');
            var href = $('<a>', {href: getRelativeHref("/searchresults.html?results="+category)}).text(categoryNames[i]);
            li.append(href);
            menu.append(li);
          }
        }

        function populateDrinks() {
          var row = $("#drinkRow");
          for (var i=0; i<drinksList.length; i++) {
            var drink = drinksList[i];
            var container = $('<div>', {"class":"col-xs-6 col-sm-4 col-lg-3"});
            var thumbnail = $('<div>', {class: "thumbnail", style: "height: 400px;"});
            var img = $('<img>', {src: drink.url, style: "width: 300px; height:200px"});
            var caption = $('<div>', {class: "caption", style: "padding-top: 0px"});
            var title = $('<h3>', {style: "font-family: georgia; color: black; text-align: center; padding-top: -10px;"}).text(drink.name);
            var titleHref = $('<a>', {href: getRelativeHref("/drinkcard.html?drink="+drink.href)});
            titleHref.append(title);
            var imageHref = $('<a>', {href: getRelativeHref("/drinkcard.html?drink="+drink.href)});
            imageHref.append(img);
            caption.append(titleHref);
            var num = Math.min(6, drink.tags.length);
            for (var j=0; j<num; j++) {
              var tag = drink.tags[j];
              var drinkHref = $('<a>', {href: getRelativeHref("/searchresults.html?results="+tag)});
              if ($.inArray(tag, alcoholList) > -1) {
                var button = $('<button>', {title:"Purple tags are alcoholic", class: "btn btn-secondary", type: "button", style: "color: black; background-color: orchid; font-family: georgia" }).text(tag);
              } else {
                var button = $('<button>', {title:"Click a tag to search for it", class: "btn btn-secondary", type: "button", style: "color: black; font-family: georgia"}).text(tag);
              }
              drinkHref.append(button);
              caption.append(drinkHref);
            }
            container.append(thumbnail);
            thumbnail.append(imageHref);
            thumbnail.append(caption);
            row.append(container);
          }
        }



    </script>



  </body>

    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src="js/bootstrap.min.js"></script>
  </body>
</html>
